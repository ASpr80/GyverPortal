![License: MIT](https://img.shields.io/badge/License-MIT-green.svg)
![author](https://img.shields.io/badge/author-AlexGyver-informational.svg)
## ВНИМАНИЕ! ЭТО БЕТА ВЕРСИЯ!
# GyverPortal
Простой конструктор веб интерфейса для esp8266 и ESP32
- Библиотека является обёрткой для стандартной ESP8266WebServer
- Позволяет быстро создать вебморду для управления и настройки своего девайса
- Компактный читаемый код в "скетче", никаких внешних обработчиков и лямбда-функций
- Конструктор использует стандартные HTML формы и CSS, генерирует статические страницы
- Элементы конструктора хранятся во Flash памяти
- Никаких глобальных буферов, всё генерируется на лету
- Простой конструктор - делаем страницы без знаний HTML и CSS
- Приятный дизайн из коробки + тёмная тема
- Адаптировано под мобильные устройства и ПК
- Встроенные инструменты для удобного парсинга значений с формы
- Возможность создать +- динамическую страницу
- Компоненты конструктора:
  - Заголовок
  - Подпись
  - Разделитель
  - Перенос строки
  - Блок для объединения компонентов
  - Поле ввода текста
  - Поле ввода пароля
  - Галочка (чекбокс)
  - Выключатель
  - Слайдер
  - Выбор времени
  - Выбор даты
  - Селектор (дропбокс)
  - Кнопка  

### Совместимость
esp8266, esp32

## Содержание
- [Установка](#install)
- [Инициализация](#init)
- [Документация](#docs)
- [Использование](#usage)
- [Примеры](#example)
- [Версии](#versions)
- [Баги и обратная связь](#feedback)

<a id="install"></a>
## Установка
- Библиотеку можно найти по названию **GyverPortal** и установить через менеджер библиотек в:
    - Arduino IDE
    - Arduino IDE v2
    - PlatformIO
- [Скачать библиотеку](https://github.com/GyverLibs/GyverPortal/archive/refs/heads/main.zip) .zip архивом для ручной установки:
    - Распаковать и положить в *C:\Program Files (x86)\Arduino\libraries* (Windows x64)
    - Распаковать и положить в *C:\Program Files\Arduino\libraries* (Windows x32)
    - Распаковать и положить в *Документы/Arduino/libraries/*
    - (Arduino IDE) автоматическая установка из .zip: *Скетч/Подключить библиотеку/Добавить .ZIP библиотеку…* и указать скачанный архив
- Читай более подробную инструкцию по установке библиотек [здесь](https://alexgyver.ru/arduino-first/#%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0_%D0%B1%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA)

<a id="init"></a>
## Инициализация
`GyverPortal portal;`

<a id="docs"></a>
## Документация
<details>
<summary>Функции конструктора</summary>

```cpp
// создание страницы
BUILD_BEGIN(строка);                // начать построение страницы. Добавляет начальный HTML код
BUILD_END();                        // завершить построение страницы. Добавляет завершающий HTML код

// темы
add.THEME(тема);                    // установить тему
GP_DEFAULT  - стандартная тема
GP_LIGHT    - светлая тема
GP_DARK     - тёмная тема

// создание формы
add.FORM_BEGIN(имя);                // начать форму с именем (имя)
add.FORM_END();                     // завершить форму

// пустая форма с одной кнопкой
add.FORM_SUBMIT(имя, текст);        // форма с именем (имя) кнопкой (текст)

// компоненты формы
add.TEXT(имя, подсказка, число);    // поле ввода текста
add.TEXT(имя, подсказка, текст);    // поле ввода текста
add.PASS(имя, подсказка, текст);    // поле ввода пароля
add.CHECK(имя);                     // чекбокс, умолч. выключен
add.CHECK(имя, состояние);          // чекбокс
add.SWITCH(имя);                    // выключатель, умолч. выключен
add.SWITCH(имя, состояние);         // выключатель
add.DATE(имя);                      // ввод даты, умолч. пустой
add.DATE(имя, CPdate);              // ввод даты
add.TIME(имя);                      // ввод времени, умолч. пустой
add.TIME(имя, CPtime);              // ввод времени
add.SELECT(имя, список);            // селектор (дропбокс), элементы списка разделены запятой
add.SELECT(имя, список, активный);  // + текущий активный пункт
add.SLIDER(имя, число, мин, макс);       // слайдер
add.SLIDER(имя, число, мин, макс, шаг);  // слайдер
add.COLOR(имя);                     // выбор цвета, умолч. чёрный
add.COLOR(имя, число);              // выбор цвета
add.SUBMIT(текст);                  // кнопка отправки формы

// прочее для оформления
add.TITLE(текст);                   // заголовок
add.LABEL(текст);                   // подпись (для кнопок, полей, чекбоксов итд)
add.LABEL(число);                   // подпись, число
add.BREAK();                           // перенести строку
add.HR();                           // горизонтальный разделитель
add.BLOCK_BEGIN();                  // начать отрисовку блока
add.BLOCK_END();                    // завершить отрисовку блока

// создание кастомной страницы
add.CUSTOM_BUILD_BEGIN(String);     // начать построение страницы с нуля
add.CUSTOM_BUILD_END();             // завершить построение страницы
add.PAGE_BEGIN();                   // начальный HTML код
add.PAGE_END();                     // завершающий HTML код
```
</details>

<details>
<summary>Методы класса</summary>

```cpp
void start();                       // запустить портал
void start(WIFI_AP);                // запустить портал с DNS сервером (для AP)
void stop();                        // остановить портал
void showPage();                    // показать страницу

void attachBuild(void f);           // подключить функцию-билдер страницы
void attachForm(char* name);        // подключить действие формы
bool tick();                        // тикер портала. Вернёт true, если портал запущен
bool action();                      // вернёт true, если было действие с браузера
bool form(char* name);              // вернёт true, если действие пришло с указанной формы

// парсеры
String getString(char* name);       // получить String строку с элемента name
char* getChars(char* name);         //получить char* строку с элемента name
void copyStr(char* name, char* dest);   // переписать char строку с элемента name к себе в dest
int getInt(char* name);             // получить число с элемента name
bool getCheck(char* name);          // получить состояние чекбокса с элемента name
CPdate getDate(char* name);         // получить дату с элемента name в формате CPdate
CPtime getTime(char* name);         // получить время с элемента name в формате CPtime
uint32_t getColor(char* name);      // получить цвет с элемента name
uint8_t getSelected(char* name, char* list); // получить номер выбранного пункта в дроплисте list
```
</details>

<details>
<summary>Типы данных</summary>

```cpp
// структура для хранения даты
struct CPdate {
  uint16_t year;
  uint8_t month, day;
};

// структура для хранения времени
struct CPtime {
  uint8_t hour, minute;
};
```
</details>

<a id="usage"></a>
## Использование
### 1. Подготовка конструктора
1. Создаём функцию вида: `void f()`. Далее в ней:
2. Создём пустую строку: `String s;`
3. Запускаем конструктор: `BUILD_BEGIN(s);`. Передаём созданную строку
4. (Опционально) применяем тему: `add.THEME(тема)`, доступные темы см. в документации
5. Строим страницу, используя конструктор или прибавляя данные к строке
6. Завершаем работу конструктора: `BUILD_END();`. Здесь происходит отправка страницы на сервер

Шаблон функции конструктора:
```cpp
void build() {
  String s;
  BUILD_BEGIN(s);
  add.THEME(GP_LIGHT);
  // собираем страницу
  // ...
  BUILD_END();
}
```

### 2. Сборка страницы
Основная суть использования форм:
- Форма имеет своё уникальное имя, должно начинаться с **/**
- Внутри формы может быть сколько угодно элементов, но только одна кнопка
- При нажатии на кнопку esp получает имя формы и данные из всех элементов внутри этой формы

Пример с двумя формами, первая может передать текст из окна ввода, вторая - только факт нажатия кнопки:
```cpp
форма_1
    ввод текста
    кнопка
форма_1

форма_2
    кнопка
форма_2
```

В конструкторе GyverPortal это будет выглядеть так:
```cpp
void build() {
  String s;                     // создать строку
  BUILD_BEGIN(s);               // запустить конструктор
  add.THEME(GP_LIGHT);          // применить тему
  
  add.FORM_BEGIN("/login");     // начать форму, передать имя
  add.TEXT("txt", "Login", ""); // ввод текста, подсказка Login, текста нет
  add.BREAK();                     // перенос строки
  add.SUBMIT("Submit");         // кнопка Submit
  add.FORM_END();               // завершить форму
  
  add.FORM_BEGIN("/exit");      // начать форму, передать имя
  add.SUBMIT("Exit");           // кнопка Exit
  add.FORM_END();               // завершить форму
  
  BUILD_END();                  // завершить построение
}
```
Все инструменты конструктора описаны в документации выше.

### 3. Подключение конструктора
Передаём в библиотеку нашу функцию-конструктор страницы:
```cpp
portal.attachBuild(build);
```
Библиотека сама будет вызывать её, когда потребуется отобразить страницу. Функций-конструкторов (а следовательно и страниц) может быть несколько и их можно переключать.

### 4. Подключение обработчиков форм
Дальше нужно передать в библиотеку имена используемых на странице форм:
```cpp
portal.attachForm("/login");
portal.attachForm("/exit");
```

### 5. Работа сервера
Для обеспечения работы сервера нужно вызывать `portal.tick()` в цикле программы. Возвращает `true`, если сервер запущен.

### 6. Парсинг действий
- При нажатии любой кнопки в браузере функция `action()` вернёт `true`
- Для поиска формы, с которой пришёл сигнал, используем `form(имя)` - вернёт `true`, если имя совпало
```cpp
if (portal.action()) {
  if (portal.form("/login")) Serial.println("Login!");
  if (portal.form("/exit")) Serial.println("Exit!");
}
```

### 7. Парсинг данных
В библиотеке реализованы готовые инструменты для полученя данных из компонентов формы (см. документацию выше). Например выведем в порт содержимое поля ввода текста:
```cpp
if (portal.action()) {
  if (portal.form("/login")) {
    Serial.println(portal.getString("txt"));
    // где "txt" - имя компонента
  }
}
```

### 8. Создаём GyverPortal глобально
```cpp
GyverPortal portal;
void build() {}

void setup() {
  // подключаемся к точке
  // ...
  portal.attachBuild(build);  
  portal.attachForm("/login");
  portal.attachForm("/exit");
  portal.start();
}

void loop() {
  portal.tick();
  if (portal.action()) {
    // ...
  }
}
```

### 9. Создаём GyverPortal локально
```cpp
void build() {}

void f() {
  GyverPortal portal;
  portal.attachBuild(build);
  portal.attachForm("/login");
  portal.attachForm("/exit");
  portal.start();
  
  while (portal.tick()) {
    if (portal.action()) {
      // ...
      
      // для выхода из цикла можно остановить портал
      // например по кнопке из формы
      if (portal.form("/exit")) portal.stop();
    }
  }
}
```

<a id="example"></a>
## Примеры
```cpp
```

<a id="versions"></a>
## Версии
- v1.0

<a id="feedback"></a>
## Баги и обратная связь
При нахождении багов создавайте **Issue**, а лучше сразу пишите на почту [alex@alexgyver.ru](mailto:alex@alexgyver.ru)  
Библиотека открыта для доработки и ваших **Pull Request**'ов!
